<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cihuata Data-Lab - Carga de Datos</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="stylesheet" href="CSS/style.css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body>
  <!-- =========================================================
       [HEADER] Barra superior: logo + navegación principal
       ========================================================= -->
  <header class="main-header">
    <div class="header-inner">
      <a href="Inicio.html" class="brand">
        <img src="Img/logo.png" alt="Cihuata Data-Lab" class="logo">
      </a>

      <nav class="main-nav">
        <a class="header-link" href="Inicio.html">Inicio</a>
        <a class="header-link" href="Guia.html">Guía</a>
        <a class="header-link" href="Contacto.html">Contacto</a>
      </nav>

      <!-- USER MENU: icono + dropdown -->
      <div class="header-user">
        <div class="user-menu">
          <!-- botón: icono circular -->
          <button id="userBtn" class="user-btn" aria-haspopup="true" aria-expanded="false" title="Cuenta">
            <!-- puedes usar un PNG en Img/user-icon.png o el SVG inline -->
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true" focusable="false">
              <path d="M12 12c2.761 0 5-2.239 5-5s-2.239-5-5-5-5 2.239-5 5 2.239 5 5 5z" stroke="currentColor"
                stroke-width="1.2" />
              <path d="M3 21c0-3.866 3.582-7 9-7s9 3.134 9 7" stroke="currentColor" stroke-width="1.2"
                stroke-linecap="round" />
            </svg>
          </button>

          <!-- dropdown -->
          <div id="userDropdown" class="user-dropdown" role="menu" aria-hidden="true">
            <div class="user-info">
              <div class="user-name" id="userName">Usuario</div>
              <div class="user-email" id="userEmail"></div>
            </div>
            <div class="dropdown-actions">
              <button id="logoutBtn" class="btn-logout">Cerrar sesión</button>
            </div>
          </div>
        </div>
      </div>
      <!-- FIN USER MENU -->

    </div>
  </header>



  <!-- =========================================================
       [MAIN] Módulo de carga de archivos (drag & drop)
       ========================================================= -->
  <main class="container">
    <section class="upload-box" aria-labelledby="upload-title">
      <h3 class="upload-title-custom" id="upload-title">
        <span class="material-icons upload-icon" aria-hidden="true">cloud_upload</span>
        Carga de Datos
      </h3>

      <input type="file" id="file-input"
        accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, .xlsx" hidden>

      <div id="drop-area" class="drop-area" role="button" tabindex="0" aria-controls="file-input">
        <span class="material-icons file-placeholder-icon" aria-hidden="true">description</span>
        <p id="file-status">Arrastra y suelta tu archivo aquí, o haz clic para seleccionar (CSV o XLSX).</p>
      </div>

      <div id="progress-container" class="progress-container hidden" aria-live="polite">
        <div id="file-info" class="file-info"></div>
        <div class="progress-bar-container" aria-hidden="true">
          <div id="progress-bar" class="progress-bar"></div>
        </div>
        <span id="progress-percent" class="progress-percent">0%</span>
      </div>

      <div id="file-preview-container" class="file-preview-container hidden">
        <div id="file-preview" class="file-preview">
          <span id="preview-filename" class="preview-filename"></span>
          <span class="material-icons file-icon-small" aria-hidden="true">description</span>
        </div>
        <button id="delete-file-btn" class="delete-file-btn" title="Eliminar archivo" aria-label="Eliminar archivo">
          <span class="material-icons" aria-hidden="true">close</span>
        </button>
      </div>

      <button id="analyze-button" class="analyze-btn" disabled>Analizar</button>
    </section>
  </main>

  <!-- =========================================================
       [FOOTER] Barra inferior con copy
       ========================================================= -->
  <footer class="footer-bar">
    <p class="footer-copy">Cihuata Data-Lab © 2025</p>
  </footer>


  <!-- =========================================================
       [SCRIPTS] Utilidades
       - Marca enlace activo según ruta actual
       ========================================================= -->





  <script>
    (function () {
      var path = (location.pathname.split('/').pop() || 'inicio.html').toLowerCase();
      document.querySelectorAll('.main-nav a').forEach(function (a) {
        var href = (a.getAttribute('href') || '').toLowerCase();
        if (href === path) a.setAttribute('aria-current', 'page');
      });
    })();
  </script>

  <script>
    // Verificación rápida: si no hay sesión, redirige al login
    (async () => {
      try {
        const r = await fetch('/session-info', { credentials: 'same-origin' });
        const d = await r.json();
        if (!d.logged) {

          window.location.href = '/Login.html';
        }
      } catch (e) {
        console.error('Error verificando sesión:', e);
        window.location.href = '/Login.html';
      }
    })();
  </script>

  <!-- carga el controlador del header (coloca antes del script principal) -->
  <script src="Javascript/header.js"></script>

  <script src="Script/script.js"></script>

</body>

</html>