<!-- public/test_upload.html -->
<!-- Formulario de prueba para subir archivos; usa name="files" -->
<!doctype html>
<html>
<head><meta charset="utf-8"><title>Prueba Upload</title></head>
<body>
  <h3>Prueba de carga</h3>
  <form id="f" action="/upload" method="post" enctype="multipart/form-data">
    <input type="file" name="files" id="fileInput" multiple />
    <button type="submit">Subir (form)</button>
  </form>

  <hr>
  <h4>Prueba via fetch (incluye cookie de sesión)</h4>
  <input type="file" id="file2" multiple />
  <button id="btn">Subir via JS</button>

  <script>
    // Subida con fetch (asegúrate de estar logueado; la cookie de sesión se enviará si son mismas credenciales)
    document.getElementById('btn').addEventListener('click', async () => {
      const input = document.getElementById('file2');
      if (!input.files.length) return alert('Selecciona un archivo');
      const fd = new FormData();
      for (let f of input.files) fd.append('files', f);
      try {
        const resp = await fetch('/upload', {
          method: 'POST',
          body: fd,
          credentials: 'include' // importante para enviar cookie de sesión
        });
        const json = await resp.json();
        alert('Respuesta: ' + JSON.stringify(json));
        console.log(json);
      } catch (err) {
        alert('Error: ' + err.message);
        console.error(err);
      }
    });
  </script>
</body>
</html>
